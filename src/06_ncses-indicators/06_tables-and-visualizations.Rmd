---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
rm(list = ls())

knitr::opts_chunk$set(echo = TRUE)

library("tidyverse")
library("janitor")

raw_collab_matrix <- read.csv("~/git/oss-2020/data/intl-indicator-output/oss_intl_collaborations_2019.csv", sep=";")

# calculate total collaborations 
total_collaboration_counts <- raw_collab_matrix %>%
  clean_names() %>% 
  replace(is.na(.), 0) %>%
  select_if(is.numeric) %>%
  summarise_all(funs(sum(.))) %>% 
  t %>% as.data.frame %>% 
  rownames_to_column() %>% 
  rename(country = rowname, num_collabs = V1)

# impute zeroes into the matrix now 
country_names <- raw_collab_matrix %>% select(Country)
imputed_collab_matrix <- raw_collab_matrix %>% select(-Country)
diag(imputed_collab_matrix) <- 0
imputed_collab_matrix <- cbind(country_names, imputed_collab_matrix)
imputed_collab_matrix

# calculate non-self collaborations 
foreign_collaboration_counts <- imputed_collab_matrix %>%
  clean_names() %>% 
  replace(is.na(.), 0) %>%
  select_if(is.numeric) %>%
  summarise_all(funs(sum(.))) %>% 
  t %>% as.data.frame %>% 
  rownames_to_column() %>% 
  rename(country = rowname, num_foreign = V1)

collab_df <- total_collaboration_counts %>% 
  left_join(foreign_collaboration_counts, by = "country") %>% 
  mutate(prc_foreign = round(num_foreign / num_collabs * 100, 2),
         prc_domestic = 100.00 - prc_foreign) %>% 
  arrange(-num_collabs)

t(collab_df) %>% as.data.frame()

```

```{r}

# Create data
set.seed(1124)
data <- matrix(sample(1:30,15) , nrow=3)
colnames(data) <- c("A","B","C","D","E")
rownames(data) <- c("var1","var2","var3")
 
# create color palette:
library(RColorBrewer)
coul <- brewer.pal(3, "Pastel2") 
 
# Transform this data in %
data_percentage <- apply(data, 2, function(x){x*100/sum(x,na.rm=T)})
 
# Make a stacked barplot--> it will be in %!
barplot(data_percentage, col=coul , border="white", xlab="group")

```




```{r}
top_15_countries <- c("United States", "China", "Germany", "United Kingdom", "India",
                      "Canada", "Brazil", "France", "Russia", "Japan", 
                      "Australia", "Netherlands", "Spain", "Poland", "Sweden")

oss_intl_collaborations_2019_prcs %>% 
  select(country, united_states, china, germany, united_kingdom, india,
         canada, brazil, france, russia, japan, 
         australia, netherlands, spain, poland, sweden) %>% 
  filter(country %in% top_15_countries) %>% 
  arrange(-united_states)
```

```{r}
oss_intl_collaborations_2019_prcs %>% 
  select(country, united_states) %>% 
  #filter(country %in% top_15_countries) %>% 
  arrange(-united_states)
```
```{r}

oss_intl_collaborations_2019_prcs %>% 
  select(country, united_states, row_sum)

quick_calc <- oss_intl_collaborations_2019 %>%
  clean_names() %>% 
  mutate(row_sum = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>% 
  select(country, row_sum) 

```














